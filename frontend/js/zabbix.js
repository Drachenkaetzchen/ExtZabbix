Ext.define("PartKeepr.JsonWithAssociations",{extend:"Ext.data.writer.Json",alias:"writer.jsonwithassociations",associations:[],getRecordData:function(a){var f=this,e,d,b,g=f.callParent(arguments);var c;Ext.apply(g,a.getAssociatedData());return g}});function i18n(a){return a}Ext.namespace("Zabbix");Ext.Loader.setPath({Zabbix:"js"});Zabbix.application=null;Ext.application({sessionManager:null,name:"Zabbix",launch:function(){Zabbix.application=this;this.sessionManager=new Zabbix.Session();this.sessionManager.on("login",this.onLogin,this);this.sessionManager.login(window.autoLoginUsername,window.autoLoginPassword)},getSessionManager:function(){return this.sessionManager},onLogin:function(){var a=new Ext.Window({layout:"fit",width:800,height:600,items:[Ext.create("Zabbix.TemplateEditorComponent")]});a.show()}});Zabbix.getRESTProxy=function(a){var b={batchActions:false,url:Zabbix.getBasePath()+"/"+a,extraParams:{debug:true,params:{output:"extend",selectApplications:"refer",selectItems:"refer",selectTriggers:"refer",selectGraphs:"refer",}},listeners:{exception:function(g,d,c){try{var h=Ext.decode(d.responseText);Zabbix.ExceptionWindow.showException(h.exception)}catch(f){var e={message:i18n("Critical Error"),detail:i18n("The server returned a response which we were not able to interpret."),exception:"",backtrace:d.responseText};Zabbix.ExceptionWindow.showException(e)}}},reader:{type:"json",root:"result",successProperty:"success",messageProperty:"message",totalProperty:"totalCount"},writer:{type:"jsonwithassociations",root:"params"}};return new Ext.data.proxy.Rest(b)};Zabbix.getApplication=function(){return Zabbix.application};Zabbix.getBasePath=function(){return"rest.php"};Ext.define("Zabbix.LoginDialog",{extend:"Ext.Window",title:i18n("Zabbix: Login"),width:400,height:125,modal:true,resizable:false,layout:"anchor",bodyStyle:"padding: 5px;",initComponent:function(){this.loginField=Ext.ComponentMgr.create({xtype:"textfield",value:"",fieldLabel:i18n("Username"),anchor:"100%"});this.passwordField=Ext.ComponentMgr.create({xtype:"textfield",inputType:"password",value:"",fieldLabel:i18n("Password"),anchor:"100%"});Ext.apply(this,{keys:[{key:Ext.EventObject.ENTER,handler:this.login,scope:this}],items:[this.loginField,this.passwordField],dockedItems:[{xtype:"toolbar",enableOverflow:true,dock:"bottom",ui:"footer",pack:"start",defaults:{minWidth:100},items:[{text:i18n("Connect"),icon:"resources/silkicons/connect.png",handler:Ext.bind(this.login,this)},{text:i18n("Close"),handler:Ext.bind(this.close,this),icon:"resources/silkicons/cancel.png"}]}]});this.callParent(arguments);this.on("show",function(){this.loginField.focus()},this)},login:function(){this.fireEvent("login",this.loginField.getValue(),this.passwordField.getValue())}});Ext.define("Zabbix.EditorGrid",{extend:"Ext.grid.Panel",alias:"widget.EditorGrid",deleteButtonText:i18n("Delete Item"),deleteButtonIcon:"resources/silkicons/delete.png",addButtonText:i18n("Add Item"),addButtonIcon:"resources/silkicons/add.png",enableTopToolbar:true,buttonTextMode:"hide",initComponent:function(){this.addEvents("itemSelect","itemDeselect","itemEdit","itemDelete","itemAdd");this.getSelectionModel().on("select",this._onItemSelect,this);this.getSelectionModel().on("deselect",this._onItemDeselect,this);this.on("itemclick",this._onItemEdit,this);this.deleteButton=Ext.create("Ext.button.Button",{text:(this.buttonTextMode!=="hide")?this.deleteButtonText:"",tooltip:this.deleteButtonText,icon:this.deleteButtonIcon,handler:Ext.bind(function(){this.fireEvent("itemDelete")},this),disabled:true});this.addButton=Ext.create("Ext.button.Button",{text:(this.buttonTextMode!=="hide")?this.addButtonText:"",tooltip:this.addButtonText,icon:this.addButtonIcon,handler:Ext.bind(function(){this.fireEvent("itemAdd")},this)});this.searchField=Ext.create("Ext.ux.form.SearchField",{store:this.store});this.topToolbar=Ext.create("Ext.toolbar.Toolbar",{dock:"top",enableOverflow:true,items:[this.addButton,this.deleteButton,{xtype:"tbfill"},this.searchField]});this.bottomToolbar=Ext.create("Ext.toolbar.Paging",{store:this.store,enableOverflow:true,dock:"bottom",displayInfo:false});this.dockedItems=new Array();this.dockedItems.push(this.bottomToolbar);if(this.enableTopToolbar){this.dockedItems.push(this.topToolbar)}this.callParent()},syncChanges:function(a){this.store.load()},_updateDeleteButton:function(a,b){if(this.getSelectionModel().getCount()==1){this.deleteButton.enable()}else{this.deleteButton.disable()}},_onItemEdit:function(b,a){this.fireEvent("itemEdit",a.getId())},_onItemSelect:function(a,b){this._updateDeleteButton(a,b);this.fireEvent("itemSelect",b)},_onItemDeselect:function(a,b){this._updateDeleteButton(a,b);this.fireEvent("itemDeselect",b)}});Ext.define("Zabbix.TemplateGrid",{extend:"Zabbix.EditorGrid",alias:"widget.TemplateGrid",columns:[{header:i18n("Template"),dataIndex:"name",flex:1},{header:i18n("Applications"),dataIndex:"_applications_count",width:50,sortable:false,hidden:true},{header:i18n("Items"),dataIndex:"_items_count",width:50,sortable:false,hidden:true},{header:i18n("Triggers"),dataIndex:"_triggers_count",width:50,sortable:false,hidden:true},{header:i18n("Graphs"),dataIndex:"_graphs_count",width:50,sortable:false,hidden:true},{header:i18n("Screens"),dataIndex:"_screens_count",width:50,sortable:false,hidden:true}],addButtonText:i18n("Add Template"),addButtonIcon:"resources/fugue-icons/icons/blue-document--plus.png",deleteButtonText:i18n("Delete Template"),deleteButtonIcon:"resources/fugue-icons/icons/blue-document--minus.png"});Ext.define("Zabbix.Editor",{extend:"Ext.form.Panel",alias:"widget.Editor",trackResetOnLoad:true,bodyStyle:"background:#DBDBDB;padding: 10px;",record:null,saveText:i18n("Save"),cancelText:i18n("Cancel"),model:null,layout:"anchor",change:false,autoScroll:true,defaults:{anchor:"100%",labelWidth:150},enableButtons:true,syncDirect:false,onFieldChange:function(){return},initComponent:function(){if(this.enableButtons){this.saveButton=Ext.create("Ext.button.Button",{text:this.saveText,icon:"resources/fugue-icons/icons/disk.png",handler:Ext.bind(this.onItemSave,this)});this.cancelButton=Ext.create("Ext.button.Button",{text:this.cancelText,icon:"resources/silkicons/cancel.png",handler:Ext.bind(this.onCancelEdit,this)});this.bottomToolbar=Ext.create("Ext.toolbar.Toolbar",{enableOverflow:true,margin:"10px",defaults:{minWidth:100},dock:"bottom",ui:"footer",items:[this.saveButton,this.cancelButton]});Ext.apply(this,{dockedItems:[this.bottomToolbar]})}this.on("dirtychange",function(b,a){});this.addEvents("editorClose","startEdit","itemSaved");this.defaults.listeners={change:Ext.bind(this.onFieldChange,this)};this.callParent()},onCancelEdit:function(){this.fireEvent("editorClose",this)},newItem:function(b){Ext.apply(b,{});var a=Ext.create(this.model,b);this.editItem(a)},editItem:function(a){this.record=a;this.getForm().loadRecord(this.record);this.show();if(this.record.getRecordName()!==""){this._setTitle(this.record.getRecordName())}this.change=false;this.fireEvent("startEdit",this)},getRecordId:function(){if(this.record){return this.record.getId()}else{return null}},onItemSave:function(){if(this.enableButtons){this.saveButton.disable();Ext.defer(function(){this.saveButton.enable()},30000,this)}this.getForm().updateRecord(this.record);this.record.save({callback:this._onSave,scope:this})},_onSave:function(a,b){if(this.enableButtons){this.saveButton.enable()}if(b.success===true){this.record=a;this.fireEvent("itemSaved",this.record)}},_setTitle:function(a){this.setTitle(a)}});Ext.define("Zabbix.TemplateEditor",{extend:"Zabbix.Editor",alias:"widget.TemplateEditor",items:[{xtype:"textfield",name:"host",maxLength:64,fieldLabel:i18n("Template name")},{xtype:"textfield",name:"name",maxLength:64,fieldLabel:i18n("Visible name")}],saveText:i18n("Save Template")});Ext.define("Zabbix.EditorComponent",{extend:"Ext.panel.Panel",alias:"widget.EditorComponent",layout:"border",padding:5,border:false,navigationClass:null,editorClass:null,store:null,model:null,deleteMessage:i18n("Do you really wish to delete the item %s?"),deleteTitle:i18n("Delete Item"),newItemText:i18n("New Item"),loadParameters:{},initComponent:function(){this.navigation=Ext.create(this.navigationClass,{region:"west",width:265,split:true,store:this.store});this.navigation.on("itemAdd",this.newRecord,this);this.navigation.on("itemDelete",this.confirmDelete,this);this.navigation.on("itemEdit",this.startEdit,this);this.editorTabPanel=Ext.create("Ext.tab.Panel",{region:"center",layout:"fit",plugins:Ext.create("Ext.ux.TabCloseMenu")});this.items=[this.navigation,this.editorTabPanel];this.callParent()},newRecord:function(b){Ext.apply(b,{});var a=this.createEditor(this.newItemText);a.newItem(b);this.editorTabPanel.add(a).show()},startEdit:function(c){var b=this.findEditor(c);if(b!==null){b.show();return}var a=Ext.ModelManager.getModel(this.model);a.load(c,{scope:this,params:this.loadParameters,success:function(d,e){b=this.createEditor(d.getRecordName());b.editItem(d);this.editorTabPanel.add(b).show()}})},findEditor:function(b){for(var a=0;a<this.editorTabPanel.items.getCount();a++){if(this.editorTabPanel.items.getAt(a).getRecordId()==b){return this.editorTabPanel.items.getAt(a)}}return null},createEditor:function(b){var a=Ext.create(this.editorClass,{store:this.store,title:b,model:this.model,closable:true,listeners:{editorClose:Ext.bind(function(c){this.editorTabPanel.remove(c)},this)}});a.on("itemSaved",this.onItemSaved,this);return a},confirmDelete:function(){var a=this.navigation.getSelectionModel().getLastSelected();var b;if(a.getRecordName){b=a.getRecordName()}else{b=a.get("name")}Ext.Msg.confirm(this.deleteTitle,sprintf(this.deleteMessage,b),function(c){if(c=="yes"){this.deleteRecord(a)}},this)},deleteRecord:function(b){var a=this.findEditor(b.get("id"));if(a!==null){this.editorTabPanel.remove(a)}b.destroy();this.store.load()},createStore:function(a){Ext.Object.merge(a,{autoLoad:true,model:this.model,autoSync:false,remoteFilter:true,remoteSort:true,pageSize:15});this.store=Ext.create("Ext.data.Store",a);this.store.on("write",function(c,b){var d=b.wasSuccessful();if(d){Ext.each(b.records,function(e){if(e.dirty){e.commit()}})}})},getStore:function(){return this.store},onItemSaved:function(a){this.navigation.syncChanges(a)}});Ext.define("Zabbix.TemplateEditorComponent",{extend:"Zabbix.EditorComponent",alias:"widget.TemplateEditorComponent",navigationClass:"Zabbix.TemplateGrid",editorClass:"Zabbix.TemplateEditor",newItemText:i18n("New Template"),model:"Zabbix.Template",loadParameters:{params:{selectGroups:"extend",selectMacros:"extend",selectHosts:"extend",output:"extend"}},queryParameters:{params:{selectApplications:"shorten"}},initComponent:function(){this.createStore({proxy:Zabbix.getRESTProxy("Template"),sorters:[{property:"host",direction:"ASC"}]});this.callParent()}});Ext.define("Zabbix.Template",{extend:"Ext.data.Model",fields:[{name:"available",type:"string"},{name:"disable_until",type:"string"},{name:"error",type:"string"},{name:"errors_from",type:"string"},{name:"host",type:"string"},{name:"hostid",type:"string"},{name:"ipmi_authtype",type:"string"},{name:"ipmi_available",type:"string"},{name:"ipmi_error",type:"string"},{name:"ipmi_errors_from",type:"string"},{name:"ipmi_password",type:"string"},{name:"ipmi_privilege",type:"string"},{name:"ipmi_username",type:"string"},{name:"jmx_available",type:"string"},{name:"jmx_disable_until",type:"string"},{name:"jmx_error",type:"string"},{name:"jmx_errors_from",type:"string"},{name:"lastaccess",type:"string"},{name:"maintenance_from",type:"string"},{name:"maintenance_status",type:"string"},{name:"maintenance_type",type:"string"},{name:"maintenance_id",type:"string"},{name:"name",type:"string"},{name:"proxy_hostid",type:"string"},{name:"snmp_available",type:"string"},{name:"snmp_disable_until",type:"string"},{name:"snmp_error",type:"string"},{name:"snmp_errors_from",type:"string"},{name:"status",type:"string"},{name:"templateid",type:"string"},{name:"_applications_count",type:"int"},{name:"_items_count",type:"int"},{name:"_triggers_count",type:"int"},{name:"_graphs_count",type:"int"},{name:"_screens_count",type:"int"}],idProperty:"templateid",proxy:Zabbix.getRESTProxy("Template"),getRecordName:function(){return this.get("name")}});Ext.define("Zabbix.User",{extend:"Ext.data.Model",fields:[{id:"id",name:"id",type:"int"},{name:"username",type:"string"},{name:"password",type:"string"}],getRecordName:function(){return this.get("username")}});Ext.define("Zabbix.Session",{extend:"Ext.util.Observable",session:null,loginDialog:null,constructor:function(a){this.addEvents({login:true});this.callParent(arguments)},login:function(b,a){this.loginDialog=Ext.create("Zabbix.LoginDialog");if(b&&a){this.onLogin(b,a)}else{this.loginDialog.on("login",this.onLogin,this);this.loginDialog.show()}},onLogin:function(c,b){var a=new Zabbix.ServiceCall("User","authenticate");a.setParameter("user",c);a.setParameter("password",b);a.setParameter("foo",{megadoll:{foo:"bla"}});a.enableAnonymous();a.setHandler(Ext.bind(this.onAfterLogin,this));a.doCall()},onAfterLogin:function(a){this.session=a;this.loginDialog.destroy();this.fireEvent("login")},getSession:function(){return this.session}});Ext.define("Ext.ux.form.SearchField",{extend:"Ext.form.field.Trigger",alias:"widget.searchfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",hasSearch:false,paramName:"params.search.host",initComponent:function(){this.callParent(arguments);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this)},afterRender:function(){this.callParent();this.triggerEl.item(0).setDisplayed("none");this.doComponentLayout()},onTrigger1Click:function(){var c=this,a=c.store,b=a.getProxy(),d;if(c.hasSearch){c.setValue("");b.extraParams[c.paramName]="";a.currentPage=1;a.load({start:0});c.hasSearch=false;c.triggerEl.item(0).setDisplayed("none");c.doComponentLayout()}},onTrigger2Click:function(){var c=this,a=c.store,b=a.getProxy(),d=c.getValue();if(d.length<1){c.onTrigger1Click();return}b.extraParams[c.paramName]=d;a.currentPage=1;a.load({start:0});c.hasSearch=true;c.triggerEl.item(0).setDisplayed("block");c.doComponentLayout()}});Ext.require(["Ext.panel.*"]);Ext.define("Ext.ux.SimpleIFrame",{extend:"Ext.Panel",alias:"widget.simpleiframe",src:"about:blank",loadingText:"Loading ...",initComponent:function(){this.updateHTML();this.callParent(arguments)},updateHTML:function(){this.html='<iframe id="iframe-'+this.id+'" style="overflow:auto;width:100%;height:100%;" frameborder="0"  src="'+this.src+'"></iframe>'},reload:function(){this.setSrc(this.src)},reset:function(){var b=this.getDOM();var a=b.parentNode;if(b&&a){b.src="about:blank";b.parentNode.removeChild(b)}b=document.createElement("iframe");b.frameBorder=0;b.src=this.src;b.id="iframe-"+this.id;b.style.overflow="auto";b.style.width="100%";b.style.height="100%";a.appendChild(b)},setSrc:function(c,a){this.src=c;var b=this.getDOM();if(b){b.src=c}},getSrc:function(){return this.src},getDOM:function(){return document.getElementById("iframe-"+this.id)},getDocument:function(){var a=this.getDOM();a=(a.contentWindow)?a.contentWindow:(a.contentDocument.document)?a.contentDocument.document:a.contentDocument;return a.document},destroy:function(){var a=this.getDOM();if(a&&a.parentNode){a.src="about:blank";a.parentNode.removeChild(a)}this.callParent(arguments)},update:function(b){var c;this.setSrc("about:blank");try{c=this.getDocument();c.open();c.write(b);c.close()}catch(a){this.reset();c=this.getDocument();c.open();c.write(b);c.close()}}});Ext.define("Ext.ux.ClearableComboBox",{extend:"Ext.form.ComboBox",alias:"widget.clearcombo",initComponent:function(){this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger x-form-clear-trigger"},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger"}]};this.callParent()},onTrigger1Click:function(){this.collapse();this.setValue("");this.fireEvent("cleared")},setValue:function(a){Ext.form.ClearableComboBox.superclass.setValue.call(this,a);if(this.rendered){this.triggers[0][!Ext.isEmpty(a)?"show":"hide"]()}},onDestroy:function(){Ext.destroy(this.triggers);Ext.form.ClearableComboBox.superclass.onDestroy.apply(this,arguments)}});Ext.override(Ext.data.Connection,{setOptions:function(k,j){var h=this,e=k.params||{},g=h.extraParams,d=k.urlParams,c=k.url||h.url,i=k.jsonData,b,a,f;if(Ext.isFunction(e)){e=e.call(j,k)}if(Ext.isFunction(c)){c=c.call(j,k)}c=this.setupUrl(k,c);f=k.rawData||k.xmlData||i||null;if(i&&!Ext.isPrimitive(i)){f=Ext.encode(f)}if(Ext.isObject(e)){e=Ext.Object.toQueryString(e)}if(Ext.isObject(g)){g=Ext.Object.toQueryString(g)}e=e+((g)?((e)?"&":"")+g:"");d=Ext.isObject(d)?Ext.Object.toQueryString(d):d;console.log(e);e=this.setupParams(k,e);b=(k.method||h.method||((e||f)?"POST":"GET")).toUpperCase();this.setupMethod(k,b);a=k.disableCaching!==false?(k.disableCaching||h.disableCaching):false;if(b==="GET"&&a){c=Ext.urlAppend(c,(k.disableCachingParam||h.disableCachingParam)+"="+(new Date().getTime()))}if((b=="GET"||f)&&e){c=Ext.urlAppend(c,e);e=null}if(d){c=Ext.urlAppend(c,d)}return{url:c,method:b,data:f||e||null}}});Ext.override(Ext.data.Connection,{setupHeaders:function(f,a,b,e){console.log("BLA");var c;if(!a.headers){a.headers={}}if(Zabbix.getApplication()!==null){c=Zabbix.getApplication().getSessionManager().getSession();if(c!==null){a.headers.auth=c}}var d=this.callOverridden(arguments);return d}});Ext.Ajax.on("beforerequest",function(c,b){console.log(b);if(b.params){for(var a in b.params){if(typeof(b.params[a])=="object"){b.params[a]=Ext.encode(b.params[a])}}}});Ext.define("Zabbix.ExceptionWindow",{extend:"Ext.window.Window",autoScroll:true,resizable:true,layout:"anchor",width:500,height:300,cls:Ext.baseCSSPrefix+"message-box",initComponent:function(){this.iconComponent=Ext.create("Ext.Component",{cls:"ext-mb-icon",width:40,height:35,style:{"float":"left"}});this.messageDiv=Ext.create("Ext.Component",{autoEl:{tag:"div"},cls:"ext-mb-text",style:"margin-left: 40px;"});this.detailDiv=Ext.create("Ext.Component",{autoEl:{tag:"div"},cls:"ext-mb-text",style:"margin-left: 40px; margin-top: 20px;"});this.exceptionDiv=Ext.create("Ext.Component",{autoEl:{tag:"div"},cls:"ext-mb-text",style:"overflow: auto"});this.traceDiv=Ext.create("Ext.Component",{autoEl:{tag:"div"},cls:"ext-mb-text"});this.exceptionDetails=Ext.create("Ext.form.FieldSet",{style:"margin-left: 40px; margin-top: 20px",title:"Exception Details",collapsible:true,collapsed:true,items:this.exceptionDiv});this.backtraceDetails=Ext.create("Ext.form.FieldSet",{style:"margin-left: 40px",title:"Backtrace",collapsible:true,collapsed:true,items:this.traceDiv});this.topContainer=Ext.create("Ext.container.Container",{xtype:"container",style:"padding: 10px",layout:"anchor",anchor:"100% 100%",items:[this.iconComponent,this.messageDiv,this.detailDiv,this.exceptionDetails,this.backtraceDetails]});this.items=this.topContainer;this.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",defaults:{minWidth:80},layout:{pack:"center"},items:[{xtype:"button",text:"OK",handler:Ext.bind(function(){this.hide()},this)}]}];this.callParent()},setIcon:function(a){this.iconComponent.removeCls(this.iconCls);if(a){this.iconComponent.show();this.iconComponent.addCls(Ext.baseCSSPrefix+"dlg-icon");this.iconComponent.addCls(a)}else{this.iconComponent.removeCls(Ext.baseCSSPrefix+"dlg-icon");this.iconComponent.hide()}},_showException:function(a){this.setIcon(Ext.MessageBox.ERROR);this.messageDiv.update(a.message);this.setTitle(a.message);if(a.detail){this.detailDiv.update(a.detail)}else{this.detailDiv.update("")}if(a.exception){this.exceptionDiv.update(a.exception)}else{this.exceptionDiv.update("No information available")}if(a.backtrace){this.traceDiv.update(nl2br("<code>"+a.backtrace+"</code>"))}else{this.traceDiv.update("No backtrace available")}this.show()},statics:{showException:function(a){if(!Zabbix.ExceptionWindow.activeInstance){Zabbix.ExceptionWindow.activeInstance=new Zabbix.ExceptionWindow()}Zabbix.ExceptionWindow.activeInstance._showException(a)}}});Ext.define("Zabbix.ServiceCall",{extend:"Ext.util.Observable",service:null,call:null,sHandler:null,parameters:{},loadMessage:null,anonymous:false,constructor:function(a,b){this.setService(a);this.setCall(b);this.parameters={}},enableAnonymous:function(){this.anonymous=true},disableAnonymous:function(){this.anonymous=false},setService:function(a){this.service=a},setCall:function(a){this.call=a},setParameter:function(b,a){this.parameters[b]=a},setParameters:function(a){Ext.apply(this.parameters,a)},setLoadMessage:function(a){this.loadMessage=a},setHandler:function(a){this.sHandler=a},doCall:function(){var a={params:Ext.encode(this.parameters)};var b={};if(!this.anonymous){a.auth=Zabbix.getApplication().getSessionManager().getSession()}Ext.Ajax.request({url:Zabbix.getBasePath()+"/"+this.service+"/"+this.call,success:Ext.bind(this.onSuccess,this),failure:Ext.bind(this.onError,this),method:"GET",params:a,headers:b})},onSuccess:function(b){try{var a=Ext.decode(b.responseText)}catch(d){var c={message:i18n("Critical Error"),detail:i18n("The server returned a response which we were not able to interpret."),exception:"",backtrace:b.responseText};Zabbix.ExceptionWindow.showException(c);return}if(a.error){this.displayError(a.error);return}if(this.sHandler){this.sHandler(a.result)}},onError:function(a){try{var d=Ext.decode(a.responseText);Zabbix.ExceptionWindow.showException(d.exception)}catch(c){var b={message:i18n("Critical Error"),detail:i18n("The server returned a response which we were not able to interpret."),exception:"",backtrace:a.responseText};Zabbix.ExceptionWindow.showException(b)}Zabbix.getApplication().getStatusbar().endLoad()},displayError:function(a){Ext.Msg.show({title:i18n("Error"),msg:this.getErrorMessage(a),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},getErrorMessage:function(a){return a.data},displaySystemError:function(b){var a;a="Error Message: "+b.message+"<br>";a+="Exception:"+b.exception+"<br>";a+="Backtrace:<br>"+str_replace("\n","<br>",b.backtrace);Ext.Msg.maxWidth=800;Ext.Msg.show({title:i18n("System Error"),msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}});function nl2br(c,b){var a=(b||typeof b==="undefined")?"<br />":"<br>";return(c+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+a+"$2")}Ext.define("Ext.ux.statusbar.StatusBar",{extend:"Ext.toolbar.Toolbar",alternateClassName:"Ext.ux.StatusBar",alias:"widget.statusbar",requires:["Ext.toolbar.TextItem"],cls:"x-statusbar",busyIconCls:"x-status-busy",busyText:"Loading...",autoClear:5000,emptyText:"&nbsp;",activeThreadId:0,initComponent:function(){if(this.statusAlign==="right"){this.cls+=" x-status-right"}this.callParent(arguments)},afterRender:function(){this.callParent(arguments);var a=this.statusAlign==="right";this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=Ext.create("Ext.toolbar.TextItem",{cls:"x-status-text "+(this.currIconCls||""),text:this.text||this.defaultText||""});if(a){this.add("->");this.add(this.statusEl)}else{this.insert(0,this.statusEl);this.insert(1,"->")}this.height=27;this.doLayout()},setStatus:function(d){d=d||{};if(Ext.isString(d)){d={text:d}}if(d.text!==undefined){this.setText(d.text)}if(d.iconCls!==undefined){this.setIcon(d.iconCls)}if(d.clear){var e=d.clear,b=this.autoClear,a={useDefaults:true,anim:true};if(Ext.isObject(e)){e=Ext.applyIf(e,a);if(e.wait){b=e.wait}}else{if(Ext.isNumber(e)){b=e;e=a}else{if(Ext.isBoolean(e)){e=a}}}e.threadId=this.activeThreadId;Ext.defer(this.clearStatus,b,this,[e])}this.doLayout();return this},clearStatus:function(c){c=c||{};if(c.threadId&&c.threadId!==this.activeThreadId){return this}var b=c.useDefaults?this.defaultText:this.emptyText,a=c.useDefaults?(this.defaultIconCls?this.defaultIconCls:""):"";if(c.anim){this.statusEl.el.puff({remove:false,useDisplay:true,scope:this,callback:function(){this.setStatus({text:b,iconCls:a});this.statusEl.el.show()}})}else{this.statusEl.hide();this.setStatus({text:b,iconCls:a});this.statusEl.show()}this.doLayout();return this},setText:function(a){this.activeThreadId++;this.text=a||"";if(this.rendered){this.statusEl.setText(this.text)}return this},getText:function(){return this.text},setIcon:function(a){this.activeThreadId++;a=a||"";if(this.rendered){if(this.currIconCls){this.statusEl.removeCls(this.currIconCls);this.currIconCls=null}if(a.length>0){this.statusEl.addCls(a);this.currIconCls=a}}else{this.currIconCls=a}return this},showBusy:function(a){if(Ext.isString(a)){a={text:a}}a=Ext.applyIf(a||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(a)}});Ext.define("Ext.tab.TabCloseMenu",{alias:"plugin.tabclosemenu",alternateClassName:"Ext.ux.TabCloseMenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:true,closeOthersTabsText:"Close Other Tabs",showCloseAll:true,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(a){this.addEvents("aftermenu","beforemenu");this.mixins.observable.constructor.call(this,a)},init:function(a){this.tabPanel=a;this.tabBar=a.down("tabbar");this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:true})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:"div.x-tab"})},onBeforeDestroy:function(){Ext.destroy(this.menu);this.callParent(arguments)},onContextMenu:function(d,f){var c=this,g=c.createMenu(),e=true,h=true,b=c.tabBar.getChildByElement(f),a=c.tabBar.items.indexOf(b);c.item=c.tabPanel.getComponent(a);g.child('*[text="'+c.closeTabText+'"]').setDisabled(!c.item.closable);if(c.showCloseAll||c.showCloseOthers){c.tabPanel.items.each(function(i){if(i.closable){e=false;if(i!=c.item){h=false;return false}}return true});if(c.showCloseAll){g.child('*[text="'+c.closeAllTabsText+'"]').setDisabled(e)}if(c.showCloseOthers){g.child('*[text="'+c.closeOthersTabsText+'"]').setDisabled(h)}}d.preventDefault();c.fireEvent("beforemenu",g,c.item,c);g.showAt(d.getXY())},createMenu:function(){var b=this;if(!b.menu){var a=[{text:b.closeTabText,scope:b,handler:b.onClose}];if(b.showCloseAll||b.showCloseOthers){a.push("-")}if(b.showCloseOthers){a.push({text:b.closeOthersTabsText,scope:b,handler:b.onCloseOthers})}if(b.showCloseAll){a.push({text:b.closeAllTabsText,scope:b,handler:b.onCloseAll})}if(b.extraItemsHead){a=b.extraItemsHead.concat(a)}if(b.extraItemsTail){a=a.concat(b.extraItemsTail)}b.menu=Ext.create("Ext.menu.Menu",{items:a,listeners:{hide:b.onHideMenu,scope:b}})}return b.menu},onHideMenu:function(){var a=this;a.item=null;a.fireEvent("aftermenu",a.menu,a)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(true)},onCloseAll:function(){this.doClose(false)},doClose:function(b){var a=[];this.tabPanel.items.each(function(c){if(c.closable){if(!b||c!=this.item){a.push(c)}}},this);Ext.each(a,function(c){this.tabPanel.remove(c)},this)}});